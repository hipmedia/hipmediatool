<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lịch Vạn Niên - Xem Lịch Âm Dương</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --glass-bg: rgba(255, 255, 255, 0.25);
      --glass-border: rgba(255, 255, 255, 0.3);
      --text-color: #fff;
      --highlight-color: #ffd700;
      --today-bg: rgba(255, 215, 0, 0.3);
    }

    body {
      font-family: 'Be Vietnam Pro', sans-serif;
      background: var(--bg-gradient);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    .calendar-container {
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      padding: 30px;
      width: 100%;
      max-width: 1000px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .month-year-display {
      font-size: 2rem;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .btn-nav {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.4);
      color: white;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .btn-nav:hover {
      background: rgba(255, 255, 255, 0.4);
      transform: scale(1.1);
    }

    .weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      font-weight: 600;
      margin-bottom: 15px;
      text-transform: uppercase;
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .days-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
    }

    .day-cell {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      min-height: 100px;
      padding: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      border: 1px solid transparent;
    }

    .day-cell:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .day-cell.today {
      background: var(--today-bg);
      border: 1px solid var(--highlight-color);
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
    }

    .day-cell.other-month {
      opacity: 0.5;
      background: rgba(0, 0, 0, 0.05);
    }

    .solar-date {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .lunar-date {
      font-size: 0.9rem;
      opacity: 0.8;
      text-align: right;
    }

    .lunar-date.highlight {
      color: var(--highlight-color);
      font-weight: bold;
    }

    /* Info Panel */
    .info-panel {
      margin-top: 30px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    .info-item {
      flex: 1;
      min-width: 200px;
    }

    .info-label {
      font-size: 0.9rem;
      opacity: 0.7;
      margin-bottom: 5px;
    }

    .info-value {
      font-size: 1.2rem;
      font-weight: 600;
    }

    @media (max-width: 768px) {
      .day-cell {
        min-height: 70px;
        padding: 5px;
      }
      .solar-date { font-size: 1.1rem; }
      .lunar-date { font-size: 0.7rem; }
      .month-year-display { font-size: 1.5rem; }
    }
  </style>
</head>
<body>

  <div class="calendar-container">
    <div class="calendar-header">
      <button class="btn-nav" id="prevMonth"><i class="fas fa-chevron-left"></i></button>
      <div class="month-year-display" id="currentMonthYear">Tháng 1 2026</div>
      <button class="btn-nav" id="nextMonth"><i class="fas fa-chevron-right"></i></button>
    </div>

    <div class="weekdays">
      <div class="text-danger">CN</div>
      <div>T2</div>
      <div>T3</div>
      <div>T4</div>
      <div>T5</div>
      <div>T6</div>
      <div class="text-primary">T7</div>
    </div>

    <div class="days-grid" id="calendarGrid">
      <!-- Days will be generated here -->
    </div>

    <div class="info-panel" id="selectedDateInfo">
      <div class="info-item">
        <div class="info-label">Dương Lịch</div>
        <div class="info-value" id="infoSolar">--/--/----</div>
      </div>
      <div class="info-item">
        <div class="info-label">Âm Lịch</div>
        <div class="info-value" id="infoLunar">--/--/----</div>
      </div>
      <div class="info-item">
        <div class="info-label">Ngày Can Chi</div>
        <div class="info-value" id="infoCanChi">--</div>
      </div>
      <div class="info-item">
        <div class="info-label">Giờ Hoàng Đạo</div>
        <div class="info-value" id="infoZodiacHours" style="font-size: 0.9rem;">--</div>
      </div>
    </div>
  </div>

  <!-- Sử dụng thư viện Lunar Calendar ổn định hơn -->
  <script src="https://cdn.jsdelivr.net/gh/tatthien/vietnamese-lunar-calendar/dist/LunarCalendar.min.js"></script>

  <script>
    // Khởi tạo đối tượng LunarCalendar từ thư viện
    const lunarCal = new LunarCalendar();

    const calendarGrid = document.getElementById('calendarGrid');
    const currentMonthYear = document.getElementById('currentMonthYear');
    const prevBtn = document.getElementById('prevMonth');
    const nextBtn = document.getElementById('nextMonth');
    
    // Thông tin chi tiết
    const infoSolar = document.getElementById('infoSolar');
    const infoLunar = document.getElementById('infoLunar');
    const infoCanChi = document.getElementById('infoCanChi');
    const infoZodiacHours = document.getElementById('infoZodiacHours');

    let currentDate = new Date();

    function renderCalendar(date) {
      const year = date.getFullYear();
      const month = date.getMonth();
      
      // Cập nhật header
      currentMonthYear.textContent = `Tháng ${month + 1} ${year}`;

      // Ngày đầu tháng và số ngày trong tháng
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();
      
      // Ngày bắt đầu của lưới (có thể là tháng trước)
      const startDayIndex = firstDay.getDay(); // 0 (CN) - 6 (T7)
      
      // Xóa lưới cũ
      calendarGrid.innerHTML = '';

      // Render ngày tháng trước (làm mờ)
      const prevMonthLastDay = new Date(year, month, 0).getDate();
      for (let i = startDayIndex; i > 0; i--) {
        const day = prevMonthLastDay - i + 1;
        const cell = createDayCell(day, month - 1, year, true);
        calendarGrid.appendChild(cell);
      }

      // Render ngày tháng hiện tại
      const today = new Date();
      for (let i = 1; i <= daysInMonth; i++) {
        const isToday = i === today.getDate() && month === today.getMonth() && year === today.getFullYear();
        const cell = createDayCell(i, month, year, false, isToday);
        calendarGrid.appendChild(cell);
        
        // Mặc định hiển thị thông tin hôm nay
        if (isToday) {
          updateInfoPanel(new Date(year, month, i));
        }
      }

      // Render ngày tháng sau (cho đủ lưới 42 ô - 6 hàng)
      const totalCells = startDayIndex + daysInMonth;
      const nextDays = 42 - totalCells;
      for (let i = 1; i <= nextDays; i++) {
        const cell = createDayCell(i, month + 1, year, true);
        calendarGrid.appendChild(cell);
      }
    }

    function createDayCell(day, month, year, isOtherMonth, isToday = false) {
      const cellDate = new Date(year, month, day);
      // Chuyển đổi sang âm lịch (Tháng trong JS là 0-11, thư viện cần 1-12)
      const luni = lunarCal.solarToLunar(day, month + 1, year);
      const lunarDay = luni.lunarDay;
      const lunarMonth = luni.lunarMonth;
      
      const div = document.createElement('div');
      div.className = `day-cell ${isOtherMonth ? 'other-month' : ''} ${isToday ? 'today' : ''}`;
      
      // HTML nội dung ô
      let lunarHtml = `<span class="lunar-date">${lunarDay}/${lunarMonth}</span>`;
      
      // Highlight ngày rằm và mùng 1
      if (lunarDay === 1 || lunarDay === 15) {
        lunarHtml = `<span class="lunar-date highlight">${lunarDay}/${lunarMonth}</span>`;
      }

      div.innerHTML = `
        <span class="solar-date">${day}</span>
        ${lunarHtml}
      `;

      // Sự kiện click
      div.addEventListener('click', () => {
        // Xóa active cũ
        document.querySelectorAll('.day-cell').forEach(c => c.style.border = '1px solid transparent');
        if (!isToday) div.style.border = '1px solid #fff';
        
        updateInfoPanel(cellDate);
      });

      return div;
    }

    function updateInfoPanel(date) {
      const luni = lunarCal.solarToLunar(date.getDate(), date.getMonth() + 1, date.getFullYear());
      
      // Format ngày dương
      infoSolar.textContent = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
      
      // Format ngày âm
      // Thư viện này không trả về isLeap trực tiếp trong object cơ bản, nhưng ta có thể hiển thị ngày tháng
      infoLunar.textContent = `${luni.lunarDay}/${luni.lunarMonth} - Năm ${luni.lunarYear}`;
      
      // Can chi
      // Tính Can Chi thủ công để đảm bảo hiển thị chính xác
      infoCanChi.textContent = getCanChiYear(luni.lunarYear);
      
      // Giờ hoàng đạo
      const zodiacs = getZodiacHours(getChiDay(date)); // Tính Chi của ngày dương lịch
      infoZodiacHours.textContent = zodiacs;
    }

    // Hàm tính Can Chi Năm
    function getCanChiYear(year) {
        const can = ["Canh", "Tân", "Nhâm", "Quý", "Giáp", "Ất", "Bính", "Đinh", "Mậu", "Kỷ"];
        const chi = ["Thân", "Dậu", "Tuất", "Hợi", "Tý", "Sửu", "Dần", "Mão", "Thìn", "Tỵ", "Ngọ", "Mùi"];
        return `${can[year % 10]} ${chi[year % 12]}`;
    }

    // Hàm tính Chi của ngày (để tính giờ hoàng đạo)
    function getChiDay(date) {
        // Tính JD (Julian Day)
        const a = Math.floor((14 - (date.getMonth() + 1)) / 12);
        const y = date.getFullYear() + 4800 - a;
        const m = (date.getMonth() + 1) + 12 * a - 3;
        const jd = date.getDate() + Math.floor((153 * m + 2) / 5) + 365 * y + Math.floor(y / 4) - Math.floor(y / 100) + Math.floor(y / 400) - 32045;
        
        const chi = ["Tý", "Sửu", "Dần", "Mão", "Thìn", "Tỵ", "Ngọ", "Mùi", "Thân", "Dậu", "Tuất", "Hợi"];
        // JD của ngày 1/1/2000 là 2451545 (Ngày Ngọ - index 6)
        return chi[(jd + 1) % 12]; 
    }

    function getZodiacHours(dayChi) {
      // Logic tính giờ hoàng đạo cơ bản dựa trên Chi của ngày
      // Tý (1), Sửu (2), Dần (3), Mão (4), Thìn (5), Tỵ (6), Ngọ (7), Mùi (8), Thân (9), Dậu (10), Tuất (11), Hợi (12)
      // Bảng giờ hoàng đạo rút gọn:
      const map = {
        'Tý': 'Tý, Sửu, Mão, Ngọ, Thân, Dậu',
        'Sửu': 'Dần, Mão, Tỵ, Thân, Tuất, Hợi',
        'Dần': 'Tý, Sửu, Thìn, Tỵ, Mùi, Tuất',
        'Mão': 'Tý, Dần, Mão, Ngọ, Mùi, Dậu',
        'Thìn': 'Dần, Thìn, Tỵ, Thân, Dậu, Hợi',
        'Tỵ': 'Sửu, Thìn, Ngọ, Mùi, Tuất, Hợi',
        'Ngọ': 'Tý, Sửu, Mão, Ngọ, Thân, Dậu',
        'Mùi': 'Dần, Mão, Tỵ, Thân, Tuất, Hợi',
        'Thân': 'Tý, Sửu, Thìn, Tỵ, Mùi, Tuất',
        'Dậu': 'Tý, Dần, Mão, Ngọ, Mùi, Dậu',
        'Tuất': 'Dần, Thìn, Tỵ, Thân, Dậu, Hợi',
        'Hợi': 'Sửu, Thìn, Ngọ, Mùi, Tuất, Hợi'
      };
      // dayChi trả về string tiếng Việt có dấu từ thư viện
      return map[dayChi] || 'Đang cập nhật...';
    }

    // Event Listeners
    prevBtn.addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar(currentDate);
    });

    nextBtn.addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar(currentDate);
    });

    // Init
    renderCalendar(currentDate);
  </script>
</body>
</html>